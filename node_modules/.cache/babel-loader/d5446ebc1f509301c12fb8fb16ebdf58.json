{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nexports.__esModule = true;\n\nvar axios_1 = require(\"axios\");\n\nvar fs = require(\"fs\");\n\nvar path = require(\"path\");\n\nvar index_1 = require(\"./index\");\n\nvar Util =\n/** @class */\nfunction () {\n  function Util(api) {\n    var _this = this;\n\n    this.api = api;\n    this.playlists = new index_1.Playlists(this.api);\n    this.users = new index_1.Users(this.api);\n    this.tracks = new index_1.Tracks(this.api);\n    /**\r\n     * Utility for awaiting a stream.Writable\r\n     */\n\n    this.awaitStream = function (writeStream) {\n      return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          return [2\n          /*return*/\n          , new Promise(function (resolve, reject) {\n            writeStream.on(\"finish\", resolve);\n            writeStream.on(\"error\", reject);\n          })];\n        });\n      });\n    };\n    /**\r\n     * Downloads the stream of a track.\r\n     */\n\n\n    this.downloadTrackStream = function (songUrl, title, folder) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var headers, html, match, url, connect, finalMP3, binary;\n\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (title.endsWith(\".mp3\")) title = title.replace(\".mp3\", \"\");\n              headers = {\n                \"referer\": \"soundcloud.com\",\n                \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\"\n              };\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(songUrl, {\n                headers: headers\n              }) // const match = html.data.match(/(?<=\"transcodings\":\\[{\"url\":\")(.*?)(?=\")/)?.[0]\n              ];\n\n            case 1:\n              html = _b.sent();\n              match = (_a = html.data.match(/(?<=,{\"url\":\")(.*?)(progressive)/)) === null || _a === void 0 ? void 0 : _a[0];\n              connect = this.api.oauthToken ? \"?auth_token=\" + this.api.oauthToken : \"?client_id=\" + this.api.clientID;\n              if (!match) return [3\n              /*break*/\n              , 3];\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(match + connect, {\n                headers: headers\n              }).then(function (r) {\n                return r.data.url;\n              })[\"catch\"](function () {\n                return Promise.reject(\"client id expired\");\n              })];\n\n            case 2:\n              url = _b.sent();\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              return [2\n              /*return*/\n              , null];\n\n            case 4:\n              finalMP3 = path.join(folder, title + \".mp3\");\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(url, {\n                headers: headers,\n                responseType: \"arraybuffer\"\n              }).then(function (r) {\n                return r.data;\n              })];\n\n            case 5:\n              binary = _b.sent();\n              fs.writeFileSync(finalMP3, Buffer.from(binary, \"binary\"));\n              return [2\n              /*return*/\n              , finalMP3];\n          }\n        });\n      });\n    };\n    /** Gets the title by scraping the html source */\n\n\n    this.getTitle = function (songUrl) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var headers, html, title;\n\n        var _a, _b;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              headers = {\n                \"referer\": \"soundcloud.com\",\n                \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\"\n              };\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(songUrl, {\n                headers: headers\n              }).then(function (r) {\n                return r.data;\n              })];\n\n            case 1:\n              html = _c.sent();\n              title = (_b = (_a = html.match(/(?<=\"og:title\" content=\")(.*?)(?=\")/)) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.replace(/\\//g, \"\");\n              return [2\n              /*return*/\n              , title];\n          }\n        });\n      });\n    };\n\n    this.downloadTrack = function (trackResolvable, folder) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var track, result, dest, url, title;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!folder) folder = \"./\";\n              if (!fs.existsSync(folder)) fs.mkdirSync(folder, {\n                recursive: true\n              });\n              if (!trackResolvable.hasOwnProperty(\"downloadable\")) return [3\n              /*break*/\n              , 4];\n              track = trackResolvable;\n              if (!(track.downloadable === true)) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(track.download_url, {\n                responseType: \"arraybuffer\",\n                params: {\n                  client_id: this.api.clientID\n                }\n              })];\n\n            case 1:\n              result = _a.sent();\n              dest = path.join(folder, track.title.replace(/\\//g, \"\") + \".\" + result.headers[\"x-amz-meta-file-type\"]);\n              fs.writeFileSync(dest, Buffer.from(result.data, \"binary\"));\n              return [2\n              /*return*/\n              , dest];\n\n            case 2:\n              return [2\n              /*return*/\n              , this.downloadTrackStream(track.permalink_url, track.title.replace(/\\//g, \"\"), folder)];\n\n            case 3:\n              return [3\n              /*break*/\n              , 6];\n\n            case 4:\n              url = trackResolvable;\n              return [4\n              /*yield*/\n              , this.getTitle(url)];\n\n            case 5:\n              title = _a.sent();\n              return [2\n              /*return*/\n              , this.downloadTrackStream(url, title, folder)];\n\n            case 6:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    this.downloadTracks = function (tracks, dest, limit) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var resultArray, i, result, _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!limit) limit = tracks.length;\n              resultArray = [];\n              i = 0;\n              _b.label = 1;\n\n            case 1:\n              if (!(i < limit)) return [3\n              /*break*/\n              , 6];\n              _b.label = 2;\n\n            case 2:\n              _b.trys.push([2, 4,, 5]);\n\n              return [4\n              /*yield*/\n              , this.downloadTrack(tracks[i], dest)];\n\n            case 3:\n              result = _b.sent();\n              resultArray.push(result);\n              return [3\n              /*break*/\n              , 5];\n\n            case 4:\n              _a = _b.sent();\n              return [3\n              /*break*/\n              , 5];\n\n            case 5:\n              i++;\n              return [3\n              /*break*/\n              , 1];\n\n            case 6:\n              return [2\n              /*return*/\n              , resultArray];\n          }\n        });\n      });\n    };\n\n    this.downloadSearch = function (query, dest, limit) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var tracks;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.tracks.search({\n                q: query\n              })];\n\n            case 1:\n              tracks = _a.sent();\n              return [2\n              /*return*/\n              , this.downloadTracks(tracks, dest, limit)];\n          }\n        });\n      });\n    };\n\n    this.downloadFavorites = function (userResolvable, dest, limit) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var tracks;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.users.favorites(userResolvable)];\n\n            case 1:\n              tracks = _a.sent();\n              return [2\n              /*return*/\n              , this.downloadTracks(tracks, dest, limit)];\n          }\n        });\n      });\n    };\n\n    this.downloadPlaylist = function (playlistResolvable, dest, limit) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var playlist;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.playlists.get(playlistResolvable)];\n\n            case 1:\n              playlist = _a.sent();\n              return [2\n              /*return*/\n              , this.downloadTracks(playlist.tracks, dest, limit)];\n          }\n        });\n      });\n    };\n\n    this.streamTrack = function (trackResolvable, folder) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var track, result, dest, dest, url, title, dest;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!folder) folder = \"./\";\n              if (!fs.existsSync(folder)) fs.mkdirSync(folder, {\n                recursive: true\n              });\n              if (!trackResolvable.hasOwnProperty(\"downloadable\")) return [3\n              /*break*/\n              , 5];\n              track = trackResolvable;\n              if (!(track.downloadable === true)) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , axios_1[\"default\"].get(track.download_url, {\n                responseType: \"arraybuffer\",\n                params: {\n                  client_id: this.api.clientID,\n                  oauth_token: this.api.oauthToken\n                }\n              })];\n\n            case 1:\n              result = _a.sent();\n              dest = path.join(folder, track.title.replace(/\\//g, \"\") + \".\" + result.headers[\"x-amz-meta-file-type\"]);\n              fs.writeFileSync(dest, Buffer.from(result.data, \"binary\"));\n              return [2\n              /*return*/\n              , fs.createReadStream(dest)];\n\n            case 2:\n              return [4\n              /*yield*/\n              , this.downloadTrackStream(track.permalink_url, track.title.replace(/\\//g, \"\"), folder)];\n\n            case 3:\n              dest = _a.sent();\n              return [2\n              /*return*/\n              , fs.createReadStream(dest)];\n\n            case 4:\n              return [3\n              /*break*/\n              , 8];\n\n            case 5:\n              url = trackResolvable;\n              return [4\n              /*yield*/\n              , this.getTitle(url)];\n\n            case 6:\n              title = _a.sent();\n              return [4\n              /*yield*/\n              , this.downloadTrackStream(url, title, folder)];\n\n            case 7:\n              dest = _a.sent();\n              return [2\n              /*return*/\n              , fs.createReadStream(dest)];\n\n            case 8:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n  } // Remove directory recursively\n\n\n  Util.prototype.removeDirectory = function (dir) {\n    if (dir === \"/\" || dir === \"./\") return;\n\n    if (fs.existsSync(dir)) {\n      fs.readdirSync(dir).forEach(function (entry) {\n        var entryPath = path.join(dir, entry);\n\n        if (fs.lstatSync(entryPath).isDirectory()) {\n          this.removeDirectory(entryPath);\n        } else {\n          fs.unlinkSync(entryPath);\n        }\n      });\n\n      try {\n        fs.rmdirSync(dir);\n      } catch (e) {\n        console.log(e);\n      }\n    }\n  };\n\n  return Util;\n}();\n\nexports.Util = Util;","map":{"version":3,"sources":["/Users/dbanta/Desktop/Aux React/aux-pwa/node_modules/soundcloud.ts/dist/entities/Util.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","exports","__esModule","axios_1","require","fs","path","index_1","Util","api","_this","playlists","Playlists","users","Users","tracks","Tracks","awaitStream","writeStream","_a","on","downloadTrackStream","songUrl","title","folder","headers","html","match","url","connect","finalMP3","binary","_b","endsWith","replace","get","data","oauthToken","clientID","r","join","responseType","writeFileSync","Buffer","from","getTitle","_c","downloadTrack","trackResolvable","track","dest","existsSync","mkdirSync","recursive","hasOwnProperty","downloadable","download_url","params","client_id","permalink_url","downloadTracks","limit","resultArray","i","downloadSearch","query","search","q","downloadFavorites","userResolvable","favorites","downloadPlaylist","playlistResolvable","playlist","streamTrack","oauth_token","createReadStream","prototype","removeDirectory","dir","readdirSync","forEach","entry","entryPath","lstatSync","isDirectory","unlinkSync","rmdirSync","console","log"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nexports.__esModule = true;\r\nvar axios_1 = require(\"axios\");\r\nvar fs = require(\"fs\");\r\nvar path = require(\"path\");\r\nvar index_1 = require(\"./index\");\r\nvar Util = /** @class */ (function () {\r\n    function Util(api) {\r\n        var _this = this;\r\n        this.api = api;\r\n        this.playlists = new index_1.Playlists(this.api);\r\n        this.users = new index_1.Users(this.api);\r\n        this.tracks = new index_1.Tracks(this.api);\r\n        /**\r\n         * Utility for awaiting a stream.Writable\r\n         */\r\n        this.awaitStream = function (writeStream) { return __awaiter(_this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                        writeStream.on(\"finish\", resolve);\r\n                        writeStream.on(\"error\", reject);\r\n                    })];\r\n            });\r\n        }); };\r\n        /**\r\n         * Downloads the stream of a track.\r\n         */\r\n        this.downloadTrackStream = function (songUrl, title, folder) { return __awaiter(_this, void 0, void 0, function () {\r\n            var headers, html, match, url, connect, finalMP3, binary;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (title.endsWith(\".mp3\"))\r\n                            title = title.replace(\".mp3\", \"\");\r\n                        headers = {\r\n                            \"referer\": \"soundcloud.com\",\r\n                            \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\"\r\n                        };\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(songUrl, { headers: headers })\r\n                            // const match = html.data.match(/(?<=\"transcodings\":\\[{\"url\":\")(.*?)(?=\")/)?.[0]\r\n                        ];\r\n                    case 1:\r\n                        html = _b.sent();\r\n                        match = (_a = html.data.match(/(?<=,{\"url\":\")(.*?)(progressive)/)) === null || _a === void 0 ? void 0 : _a[0];\r\n                        connect = this.api.oauthToken ? \"?auth_token=\" + this.api.oauthToken : \"?client_id=\" + this.api.clientID;\r\n                        if (!match) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(match + connect, { headers: headers }).then(function (r) { return r.data.url; })[\"catch\"](function () {\r\n                                return Promise.reject(\"client id expired\");\r\n                            })];\r\n                    case 2:\r\n                        url = _b.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: return [2 /*return*/, null];\r\n                    case 4:\r\n                        finalMP3 = path.join(folder, title + \".mp3\");\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(url, { headers: headers, responseType: \"arraybuffer\" }).then(function (r) { return r.data; })];\r\n                    case 5:\r\n                        binary = _b.sent();\r\n                        fs.writeFileSync(finalMP3, Buffer.from(binary, \"binary\"));\r\n                        return [2 /*return*/, finalMP3];\r\n                }\r\n            });\r\n        }); };\r\n        /** Gets the title by scraping the html source */\r\n        this.getTitle = function (songUrl) { return __awaiter(_this, void 0, void 0, function () {\r\n            var headers, html, title;\r\n            var _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        headers = {\r\n                            \"referer\": \"soundcloud.com\",\r\n                            \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\"\r\n                        };\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(songUrl, { headers: headers }).then(function (r) { return r.data; })];\r\n                    case 1:\r\n                        html = _c.sent();\r\n                        title = (_b = (_a = html.match(/(?<=\"og:title\" content=\")(.*?)(?=\")/)) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.replace(/\\//g, \"\");\r\n                        return [2 /*return*/, title];\r\n                }\r\n            });\r\n        }); };\r\n        this.downloadTrack = function (trackResolvable, folder) { return __awaiter(_this, void 0, void 0, function () {\r\n            var track, result, dest, url, title;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!folder)\r\n                            folder = \"./\";\r\n                        if (!fs.existsSync(folder))\r\n                            fs.mkdirSync(folder, { recursive: true });\r\n                        if (!trackResolvable.hasOwnProperty(\"downloadable\")) return [3 /*break*/, 4];\r\n                        track = trackResolvable;\r\n                        if (!(track.downloadable === true)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(track.download_url, { responseType: \"arraybuffer\", params: { client_id: this.api.clientID } })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        dest = path.join(folder, track.title.replace(/\\//g, \"\") + \".\" + result.headers[\"x-amz-meta-file-type\"]);\r\n                        fs.writeFileSync(dest, Buffer.from(result.data, \"binary\"));\r\n                        return [2 /*return*/, dest];\r\n                    case 2: return [2 /*return*/, this.downloadTrackStream(track.permalink_url, track.title.replace(/\\//g, \"\"), folder)];\r\n                    case 3: return [3 /*break*/, 6];\r\n                    case 4:\r\n                        url = trackResolvable;\r\n                        return [4 /*yield*/, this.getTitle(url)];\r\n                    case 5:\r\n                        title = _a.sent();\r\n                        return [2 /*return*/, this.downloadTrackStream(url, title, folder)];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        this.downloadTracks = function (tracks, dest, limit) { return __awaiter(_this, void 0, void 0, function () {\r\n            var resultArray, i, result, _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!limit)\r\n                            limit = tracks.length;\r\n                        resultArray = [];\r\n                        i = 0;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(i < limit)) return [3 /*break*/, 6];\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        _b.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.downloadTrack(tracks[i], dest)];\r\n                    case 3:\r\n                        result = _b.sent();\r\n                        resultArray.push(result);\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        _a = _b.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 5:\r\n                        i++;\r\n                        return [3 /*break*/, 1];\r\n                    case 6: return [2 /*return*/, resultArray];\r\n                }\r\n            });\r\n        }); };\r\n        this.downloadSearch = function (query, dest, limit) { return __awaiter(_this, void 0, void 0, function () {\r\n            var tracks;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.tracks.search({ q: query })];\r\n                    case 1:\r\n                        tracks = _a.sent();\r\n                        return [2 /*return*/, this.downloadTracks(tracks, dest, limit)];\r\n                }\r\n            });\r\n        }); };\r\n        this.downloadFavorites = function (userResolvable, dest, limit) { return __awaiter(_this, void 0, void 0, function () {\r\n            var tracks;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.users.favorites(userResolvable)];\r\n                    case 1:\r\n                        tracks = _a.sent();\r\n                        return [2 /*return*/, this.downloadTracks(tracks, dest, limit)];\r\n                }\r\n            });\r\n        }); };\r\n        this.downloadPlaylist = function (playlistResolvable, dest, limit) { return __awaiter(_this, void 0, void 0, function () {\r\n            var playlist;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.playlists.get(playlistResolvable)];\r\n                    case 1:\r\n                        playlist = _a.sent();\r\n                        return [2 /*return*/, this.downloadTracks(playlist.tracks, dest, limit)];\r\n                }\r\n            });\r\n        }); };\r\n        this.streamTrack = function (trackResolvable, folder) { return __awaiter(_this, void 0, void 0, function () {\r\n            var track, result, dest, dest, url, title, dest;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!folder)\r\n                            folder = \"./\";\r\n                        if (!fs.existsSync(folder))\r\n                            fs.mkdirSync(folder, { recursive: true });\r\n                        if (!trackResolvable.hasOwnProperty(\"downloadable\")) return [3 /*break*/, 5];\r\n                        track = trackResolvable;\r\n                        if (!(track.downloadable === true)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, axios_1[\"default\"].get(track.download_url, { responseType: \"arraybuffer\", params: { client_id: this.api.clientID, oauth_token: this.api.oauthToken } })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        dest = path.join(folder, track.title.replace(/\\//g, \"\") + \".\" + result.headers[\"x-amz-meta-file-type\"]);\r\n                        fs.writeFileSync(dest, Buffer.from(result.data, \"binary\"));\r\n                        return [2 /*return*/, fs.createReadStream(dest)];\r\n                    case 2: return [4 /*yield*/, this.downloadTrackStream(track.permalink_url, track.title.replace(/\\//g, \"\"), folder)];\r\n                    case 3:\r\n                        dest = _a.sent();\r\n                        return [2 /*return*/, fs.createReadStream(dest)];\r\n                    case 4: return [3 /*break*/, 8];\r\n                    case 5:\r\n                        url = trackResolvable;\r\n                        return [4 /*yield*/, this.getTitle(url)];\r\n                    case 6:\r\n                        title = _a.sent();\r\n                        return [4 /*yield*/, this.downloadTrackStream(url, title, folder)];\r\n                    case 7:\r\n                        dest = _a.sent();\r\n                        return [2 /*return*/, fs.createReadStream(dest)];\r\n                    case 8: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n    }\r\n    // Remove directory recursively\r\n    Util.prototype.removeDirectory = function (dir) {\r\n        if (dir === \"/\" || dir === \"./\")\r\n            return;\r\n        if (fs.existsSync(dir)) {\r\n            fs.readdirSync(dir).forEach(function (entry) {\r\n                var entryPath = path.join(dir, entry);\r\n                if (fs.lstatSync(entryPath).isDirectory()) {\r\n                    this.removeDirectory(entryPath);\r\n                }\r\n                else {\r\n                    fs.unlinkSync(entryPath);\r\n                }\r\n            });\r\n            try {\r\n                fs.rmdirSync(dir);\r\n            }\r\n            catch (e) {\r\n                console.log(e);\r\n            }\r\n        }\r\n    };\r\n    return Util;\r\n}());\r\nexports.Util = Util;\r\n"]},"metadata":{},"sourceType":"script"}