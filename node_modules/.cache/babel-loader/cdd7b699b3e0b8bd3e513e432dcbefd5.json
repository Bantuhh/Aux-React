{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar spotify_1 = require(\"./spotify\");\n\nvar styles_1 = require(\"./styles\");\n\nvar utils_1 = require(\"./utils\");\n\nexports.STATUS = utils_1.STATUS;\nexports.TYPE = utils_1.TYPE;\n\nvar Actions_1 = require(\"./components/Actions\");\n\nvar Content_1 = require(\"./components/Content\");\n\nvar Controls_1 = require(\"./components/Controls\");\n\nvar ErrorMessage_1 = require(\"./components/ErrorMessage\");\n\nvar Info_1 = require(\"./components/Info\");\n\nvar Loader_1 = require(\"./components/Loader\");\n\nvar Player_1 = require(\"./components/Player\");\n\nvar Slider_1 = require(\"./components/Slider\");\n\nvar SpotifyWebPlayer = function (_super) {\n  __extends(SpotifyWebPlayer, _super);\n\n  function SpotifyWebPlayer(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._isMounted = false;\n    _this.emptyTrack = {\n      artists: '',\n      durationMs: 0,\n      id: '',\n      image: '',\n      name: '',\n      uri: ''\n    };\n    _this.hasNewToken = false;\n    _this.seekUpdateInterval = 100;\n\n    _this.handleChangeRange = function (position) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var track, token, percentage, state, error_1;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              track = this.state.track;\n              token = this.props.token;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 8,, 9]);\n\n              percentage = position / 100;\n              if (!this.isExternalPlayer) return [3, 3];\n              return [4, spotify_1.seek(Math.round(track.durationMs * percentage), token)];\n\n            case 2:\n              _a.sent();\n\n              this.updateState({\n                position: position,\n                progressMs: Math.round(track.durationMs * percentage)\n              });\n              return [3, 7];\n\n            case 3:\n              if (!this.player) return [3, 7];\n              return [4, this.player.getCurrentState()];\n\n            case 4:\n              state = _a.sent();\n              if (!state) return [3, 6];\n              return [4, this.player.seek(Math.round(state.track_window.current_track.duration_ms * percentage))];\n\n            case 5:\n              _a.sent();\n\n              return [3, 7];\n\n            case 6:\n              this.updateState({\n                position: 0\n              });\n              _a.label = 7;\n\n            case 7:\n              return [3, 9];\n\n            case 8:\n              error_1 = _a.sent();\n              console.error(error_1);\n              return [3, 9];\n\n            case 9:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleClickTogglePlay = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var error_2;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 2,, 3]);\n\n              return [4, this.togglePlay()];\n\n            case 1:\n              _a.sent();\n\n              return [3, 3];\n\n            case 2:\n              error_2 = _a.sent();\n              console.error(error_2);\n              return [3, 3];\n\n            case 3:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleClickPrevious = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token, error_3;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 5,, 6]);\n\n              if (!this.isExternalPlayer) return [3, 2];\n              token = this.props.token;\n              return [4, spotify_1.previous(token)];\n\n            case 1:\n              _a.sent();\n\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3, 4];\n\n            case 2:\n              if (!this.player) return [3, 4];\n              return [4, this.player.previousTrack()];\n\n            case 3:\n              _a.sent();\n\n              _a.label = 4;\n\n            case 4:\n              return [3, 6];\n\n            case 5:\n              error_3 = _a.sent();\n              console.error(error_3);\n              return [3, 6];\n\n            case 6:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleClickNext = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token, error_4;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 5,, 6]);\n\n              if (!this.isExternalPlayer) return [3, 2];\n              token = this.props.token;\n              return [4, spotify_1.next(token)];\n\n            case 1:\n              _a.sent();\n\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3, 4];\n\n            case 2:\n              if (!this.player) return [3, 4];\n              return [4, this.player.nextTrack()];\n\n            case 3:\n              _a.sent();\n\n              _a.label = 4;\n\n            case 4:\n              return [3, 6];\n\n            case 5:\n              error_4 = _a.sent();\n              console.error(error_4);\n              return [3, 6];\n\n            case 6:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleClickDevice = function (deviceId) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var isUnsupported, token, error_5;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              isUnsupported = this.state.isUnsupported;\n              token = this.props.token;\n              this.updateState({\n                currentDeviceId: deviceId\n              });\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 6,, 7]);\n\n              return [4, spotify_1.setDevice(deviceId, token)];\n\n            case 2:\n              _a.sent();\n\n              if (!isUnsupported) return [3, 5];\n              return [4, this.togglePlay(true)];\n\n            case 3:\n              _a.sent();\n\n              return [4, this.syncDevice()];\n\n            case 4:\n              _a.sent();\n\n              _a.label = 5;\n\n            case 5:\n              return [3, 7];\n\n            case 6:\n              error_5 = _a.sent();\n              console.error(error_5);\n              return [3, 7];\n\n            case 7:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleFavoriteStatusChange = function (isSaved) {\n      var callback = _this.props.callback;\n\n      _this.updateState({\n        isSaved: isSaved\n      });\n\n      callback(__assign({}, __assign({}, _this.state, {\n        isSaved: isSaved\n      }), {\n        type: utils_1.TYPE.TRACK\n      }));\n    };\n\n    _this.handlePlayerErrors = function (type, message) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var status, isPlaybackError, isInitializationError, nextStatus;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              status = this.state.status;\n              isPlaybackError = type === 'playback_error';\n              isInitializationError = type === 'initialization_error';\n              nextStatus = status;\n              if (!(this.player && !isPlaybackError)) return [3, 2];\n              return [4, this.player.disconnect()];\n\n            case 1:\n              _a.sent();\n\n              _a.label = 2;\n\n            case 2:\n              if (isInitializationError) {\n                nextStatus = utils_1.STATUS.UNSUPPORTED;\n              }\n\n              if (!isInitializationError && !isPlaybackError) {\n                nextStatus = utils_1.STATUS.ERROR;\n              }\n\n              this.updateState({\n                error: message,\n                errorType: type,\n                isInitializing: false,\n                isUnsupported: isInitializationError,\n                status: nextStatus\n              });\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handlePlayerStateChanges = function (state) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var isPlaying, _a, album, artists, duration_ms, id, name_1, uri, volume, track, error_6;\n\n        return __generator(this, function (_b) {\n          console.log('PlayerStateChange', _b.label);\n\n          switch (_b.label) {\n            case 0:\n              _b.trys.push([0, 6,, 7]);\n\n              if (!state) return [3, 2];\n              isPlaying = !state.paused;\n              _a = state.track_window.current_track, album = _a.album, artists = _a.artists, duration_ms = _a.duration_ms, id = _a.id, name_1 = _a.name, uri = _a.uri;\n              return [4, this.player.getVolume()];\n\n            case 1:\n              volume = _b.sent();\n              track = {\n                artists: artists.map(function (d) {\n                  return d.name;\n                }).join(', '),\n                durationMs: duration_ms,\n                id: id,\n                image: this.setAlbumImage(album),\n                name: name_1,\n                uri: uri\n              };\n              this.updateState({\n                error: '',\n                errorType: '',\n                isActive: true,\n                isPlaying: isPlaying,\n                nextTracks: state.track_window.next_tracks,\n                previousTracks: state.track_window.previous_tracks,\n                track: track,\n                volume: volume\n              });\n              return [3, 5];\n\n            case 2:\n              if (!this.isExternalPlayer) return [3, 4];\n              return [4, this.syncDevice()];\n\n            case 3:\n              _b.sent();\n\n              return [3, 5];\n\n            case 4:\n              this.updateState({\n                isActive: false,\n                isPlaying: false,\n                nextTracks: [],\n                position: 0,\n                previousTracks: [],\n                track: {\n                  artists: '',\n                  durationMs: 0,\n                  id: '',\n                  image: '',\n                  name: '',\n                  uri: ''\n                }\n              });\n              _b.label = 5;\n\n            case 5:\n              return [3, 7];\n\n            case 6:\n              error_6 = _b.sent();\n              console.error(error_6);\n              return [3, 7];\n\n            case 7:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handlePlayerStatus = function (_a) {\n      var device_id = _a.device_id;\n      return __awaiter(_this, void 0, void 0, function () {\n        var _b, currentDeviceId, devices;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              return [4, this.initializeDevices(device_id)];\n\n            case 1:\n              _b = _c.sent(), currentDeviceId = _b.currentDeviceId, devices = _b.devices;\n              this.updateState({\n                currentDeviceId: currentDeviceId,\n                deviceId: device_id,\n                devices: devices,\n                isInitializing: false,\n                status: device_id ? utils_1.STATUS.READY : utils_1.STATUS.IDLE\n              });\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.handleToggleMagnify = function () {\n      var magnifySliderOnHover = _this.props.magnifySliderOnHover;\n\n      if (magnifySliderOnHover) {\n        _this.updateState(function (prevState) {\n          return {\n            isMagnified: !prevState.isMagnified\n          };\n        });\n      }\n    };\n\n    _this.initializePlayer = function () {\n      var _a = _this.props,\n          name = _a.name,\n          token = _a.token;\n\n      _this.updateState({\n        isInitializing: true\n      });\n\n      _this.player = new window.Spotify.Player({\n        getOAuthToken: function (cb) {\n          cb(token);\n        },\n        name: name\n      });\n\n      _this.player.addListener('ready', _this.handlePlayerStatus);\n\n      _this.player.addListener('not_ready', _this.handlePlayerStatus);\n\n      _this.player.addListener('player_state_changed', _this.handlePlayerStateChanges);\n\n      _this.player.addListener('initialization_error', function (error) {\n        return _this.handlePlayerErrors('initialization_error', error.message);\n      });\n\n      _this.player.addListener('authentication_error', function (error) {\n        return _this.handlePlayerErrors('authentication_error', error.message);\n      });\n\n      _this.player.addListener('account_error', function (error) {\n        return _this.handlePlayerErrors('account_error', error.message);\n      });\n\n      _this.player.addListener('playback_error', function (error) {\n        return _this.handlePlayerErrors('playback_error', error.message);\n      });\n\n      _this.player.connect();\n    };\n\n    _this.setVolume = function (volume) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              token = this.props.token;\n              if (!this.isExternalPlayer) return [3, 3];\n              return [4, spotify_1.setVolume(Math.round(volume * 100), token)];\n\n            case 1:\n              _a.sent();\n\n              return [4, this.syncDevice()];\n\n            case 2:\n              _a.sent();\n\n              return [3, 5];\n\n            case 3:\n              if (!this.player) return [3, 5];\n              return [4, this.player.setVolume(volume)];\n\n            case 4:\n              _a.sent();\n\n              _a.label = 5;\n\n            case 5:\n              this.updateState({\n                volume: volume\n              });\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.syncDevice = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token, player, track, error_7;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!this._isMounted) {\n                return [2];\n              }\n\n              token = this.props.token;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4, spotify_1.getPlaybackState(token)];\n\n            case 2:\n              player = _a.sent();\n              track = this.emptyTrack;\n\n              if (!player) {\n                throw new Error('No player');\n              }\n\n              if (player.item) {\n                track = {\n                  artists: player.item.artists.map(function (d) {\n                    return d.name;\n                  }).join(', '),\n                  durationMs: player.item.duration_ms,\n                  id: player.item.id,\n                  image: this.setAlbumImage(player.item.album),\n                  name: player.item.name,\n                  uri: player.item.uri\n                };\n              }\n\n              this.updateState({\n                error: '',\n                errorType: '',\n                isActive: true,\n                isPlaying: player.is_playing,\n                nextTracks: [],\n                previousTracks: [],\n                progressMs: player.item ? player.progress_ms : 0,\n                status: utils_1.STATUS.READY,\n                track: track,\n                volume: player.device.volume_percent / 100\n              });\n              return [3, 4];\n\n            case 3:\n              error_7 = _a.sent();\n              this.updateState({\n                error: error_7.message,\n                errorType: 'player_status',\n                status: utils_1.STATUS.ERROR\n              });\n              return [3, 4];\n\n            case 4:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.toggleOffset = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, currentDeviceId, isPlaying, _b, offset, token, uris;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying;\n              _b = this.props, offset = _b.offset, token = _b.token, uris = _b.uris;\n              if (!(isPlaying && typeof offset === 'number' && Array.isArray(uris))) return [3, 2];\n              return [4, spotify_1.play({\n                deviceId: currentDeviceId,\n                offset: offset,\n                uris: uris\n              }, token)];\n\n            case 1:\n              _c.sent();\n\n              _c.label = 2;\n\n            case 2:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.togglePlay = function (init) {\n      if (init === void 0) {\n        init = false;\n      }\n\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, currentDeviceId, isPlaying, needsUpdate, _b, offset, token, shouldInitialize, playerState, error_8;\n\n        var _this = this;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying, needsUpdate = _a.needsUpdate;\n              _b = this.props, offset = _b.offset, token = _b.token;\n              shouldInitialize = init || needsUpdate;\n              _c.label = 1;\n\n            case 1:\n              _c.trys.push([1, 12,, 13]);\n\n              if (!this.isExternalPlayer) return [3, 6];\n              if (!!isPlaying) return [3, 3];\n              return [4, spotify_1.play(__assign({\n                deviceId: currentDeviceId,\n                offset: offset\n              }, shouldInitialize ? this.playOptions : undefined), token)];\n\n            case 2:\n              _c.sent();\n\n              return [3, 5];\n\n            case 3:\n              return [4, spotify_1.pause(token)];\n\n            case 4:\n              _c.sent();\n\n              this.updateState({\n                isPlaying: false\n              });\n              _c.label = 5;\n\n            case 5:\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3, 11];\n\n            case 6:\n              if (!this.player) return [3, 11];\n              return [4, this.player.getCurrentState()];\n\n            case 7:\n              playerState = _c.sent();\n              if (!(!playerState && !!(this.playOptions.context_uri || this.playOptions.uris) || shouldInitialize && playerState && playerState.paused)) return [3, 9];\n              return [4, spotify_1.play(__assign({\n                deviceId: currentDeviceId,\n                offset: offset\n              }, shouldInitialize ? this.playOptions : undefined), token)];\n\n            case 8:\n              _c.sent();\n\n              return [3, 11];\n\n            case 9:\n              return [4, this.player.togglePlay()];\n\n            case 10:\n              _c.sent();\n\n              _c.label = 11;\n\n            case 11:\n              if (needsUpdate) {\n                this.updateState({\n                  needsUpdate: false\n                });\n              }\n\n              return [3, 13];\n\n            case 12:\n              error_8 = _c.sent();\n              console.error(error_8);\n              return [3, 13];\n\n            case 13:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.updateSeekBar = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, isPlaying, progressMs, track, position, state, position, error_9;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!this._isMounted) {\n                return [2];\n              }\n\n              _a = this.state, isPlaying = _a.isPlaying, progressMs = _a.progressMs, track = _a.track;\n              _b.label = 1;\n\n            case 1:\n              _b.trys.push([1, 5,, 6]);\n\n              if (!isPlaying) return [3, 4];\n              if (!this.isExternalPlayer) return [3, 2];\n              position = progressMs / track.durationMs;\n              position = Number.isFinite(position) ? position : 0;\n              this.updateState({\n                position: Number((position * 100).toFixed(1)),\n                progressMs: progressMs + this.seekUpdateInterval\n              });\n              return [3, 4];\n\n            case 2:\n              if (!this.player) return [3, 4];\n              return [4, this.player.getCurrentState()];\n\n            case 3:\n              state = _b.sent();\n\n              if (state) {\n                position = state.position / state.track_window.current_track.duration_ms;\n                this.updateState({\n                  position: Number((position * 100).toFixed(1))\n                });\n              }\n\n              _b.label = 4;\n\n            case 4:\n              return [3, 6];\n\n            case 5:\n              error_9 = _b.sent();\n              console.error(error_9);\n              return [3, 6];\n\n            case 6:\n              return [2];\n          }\n        });\n      });\n    };\n\n    _this.updateState = function (state) {\n      if (!_this._isMounted) {\n        return;\n      }\n\n      _this.setState(state);\n    };\n\n    _this.state = {\n      currentDeviceId: '',\n      deviceId: '',\n      devices: [],\n      error: '',\n      errorType: '',\n      isActive: false,\n      isInitializing: false,\n      isMagnified: false,\n      isPlaying: false,\n      isSaved: false,\n      isUnsupported: false,\n      needsUpdate: false,\n      nextTracks: [],\n      position: 0,\n      previousTracks: [],\n      status: utils_1.STATUS.IDLE,\n      track: _this.emptyTrack,\n      volume: 1\n    };\n    _this.styles = styles_1.getMergedStyles(props.styles);\n    return _this;\n  }\n\n  SpotifyWebPlayer.prototype.componentDidMount = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this._isMounted = true;\n            this.updateState({\n              status: utils_1.STATUS.INITIALIZING\n            });\n            window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n            return [4, utils_1.loadScript({\n              defer: true,\n              id: 'spotify-player',\n              source: 'https://sdk.scdn.co/spotify-player.js'\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.componentDidUpdate = function (prevProps, prevState) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, currentDeviceId, deviceId, error, isInitializing, isPlaying, status, track, _b, autoPlay, callback, offset, playProp, showSaveIcon, token, uris, isReady, changedURIs, canPlay, shouldPlay;\n\n      var _this = this;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _a = this.state, currentDeviceId = _a.currentDeviceId, deviceId = _a.deviceId, error = _a.error, isInitializing = _a.isInitializing, isPlaying = _a.isPlaying, status = _a.status, track = _a.track;\n            _b = this.props, autoPlay = _b.autoPlay, callback = _b.callback, offset = _b.offset, playProp = _b.play, showSaveIcon = _b.showSaveIcon, token = _b.token, uris = _b.uris;\n            isReady = prevState.status !== utils_1.STATUS.READY && status === utils_1.STATUS.READY;\n            changedURIs = Array.isArray(uris) ? !utils_1.isEqualArray(prevProps.uris, uris) : uris !== uris;\n            canPlay = !!currentDeviceId && !!(this.playOptions.context_uri || this.playOptions.uris);\n            shouldPlay = !!(changedURIs && isPlaying) || !!(isReady && (autoPlay || playProp));\n            if (!(canPlay && shouldPlay)) return [3, 2];\n            return [4, spotify_1.play(__assign({\n              deviceId: currentDeviceId,\n              offset: offset\n            }, this.playOptions), token)];\n\n          case 1:\n            _c.sent();\n\n            if (!this.state.isPlaying) {\n              this.updateState({\n                isPlaying: true\n              });\n            }\n\n            if (this.isExternalPlayer) {\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 600);\n            }\n\n            return [3, 3];\n\n          case 2:\n            if (changedURIs && !isPlaying) {\n              this.updateState({\n                needsUpdate: true\n              });\n            }\n\n            _c.label = 3;\n\n          case 3:\n            if (prevState.status !== status) {\n              callback(__assign({}, this.state, {\n                type: utils_1.TYPE.STATUS\n              }));\n            }\n\n            if (prevState.track.id !== track.id && track.id) {\n              callback(__assign({}, this.state, {\n                type: utils_1.TYPE.TRACK\n              }));\n\n              if (showSaveIcon) {\n                this.updateState({\n                  isSaved: false\n                });\n              }\n            }\n\n            if (!(prevState.currentDeviceId !== currentDeviceId && currentDeviceId)) return [3, 5];\n            return [4, this.handleDeviceChange()];\n\n          case 4:\n            _c.sent();\n\n            if (!isReady) {\n              callback(__assign({}, this.state, {\n                type: utils_1.TYPE.DEVICE\n              }));\n            }\n\n            _c.label = 5;\n\n          case 5:\n            if (!(prevState.isPlaying !== isPlaying)) return [3, 7];\n            this.handlePlaybackStatus();\n            return [4, this.handleDeviceChange()];\n\n          case 6:\n            _c.sent();\n\n            callback(__assign({}, this.state, {\n              type: utils_1.TYPE.PLAYER\n            }));\n            _c.label = 7;\n\n          case 7:\n            if (prevState.isInitializing && !isInitializing) {\n              if (error === 'authentication_error' && this.hasNewToken) {\n                this.hasNewToken = false;\n                this.initializePlayer();\n              }\n            }\n\n            if (prevProps.token && prevProps.token !== token) {\n              this.hasNewToken = true;\n\n              if (!isInitializing) {\n                this.initializePlayer();\n              } else {\n                this.hasNewToken = true;\n              }\n            }\n\n            if (!(prevProps.play !== playProp && playProp !== isPlaying)) return [3, 9];\n            return [4, this.togglePlay(true)];\n\n          case 8:\n            _c.sent();\n\n            _c.label = 9;\n\n          case 9:\n            if (!(prevProps.offset !== offset)) return [3, 11];\n            return [4, this.toggleOffset()];\n\n          case 10:\n            _c.sent();\n\n            _c.label = 11;\n\n          case 11:\n            if (error === 'No player') {\n              this.updateState({\n                currentDeviceId: deviceId,\n                error: '',\n                errorType: ''\n              });\n            }\n\n            return [2];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n\n    if (this.player) {\n      this.player.disconnect();\n    }\n\n    clearInterval(this.playerSyncInterval);\n    clearInterval(this.playerProgressInterval);\n    clearTimeout(this.syncTimeout);\n  };\n\n  Object.defineProperty(SpotifyWebPlayer.prototype, \"isExternalPlayer\", {\n    get: function () {\n      var _a = this.state,\n          currentDeviceId = _a.currentDeviceId,\n          deviceId = _a.deviceId,\n          status = _a.status;\n      return currentDeviceId && currentDeviceId !== deviceId || status === utils_1.STATUS.UNSUPPORTED;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SpotifyWebPlayer.prototype, \"playOptions\", {\n    get: function () {\n      var uris = this.props.uris;\n      var response = {\n        context_uri: undefined,\n        uris: undefined\n      };\n\n      if (uris) {\n        var ids = Array.isArray(uris) ? uris : [uris];\n\n        if (ids.length > 1 && utils_1.getSpotifyURIType(ids[0]) === 'track') {\n          response.uris = ids.filter(function (d) {\n            return utils_1.validateURI(d) && utils_1.getSpotifyURIType(d) === 'track';\n          });\n        } else {\n          response.context_uri = ids[0];\n        }\n      }\n\n      return response;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  SpotifyWebPlayer.prototype.handleDeviceChange = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var isPlaying, syncExternalDeviceInterval, error_10;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isPlaying = this.state.isPlaying;\n            syncExternalDeviceInterval = this.props.syncExternalDeviceInterval;\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 4,, 5]);\n\n            if (!(this.isExternalPlayer && isPlaying && !this.playerSyncInterval)) return [3, 3];\n            return [4, this.syncDevice()];\n\n          case 2:\n            _a.sent();\n\n            this.playerSyncInterval = window.setInterval(this.syncDevice, syncExternalDeviceInterval * 1000);\n            _a.label = 3;\n\n          case 3:\n            if ((!isPlaying || !this.isExternalPlayer) && this.playerSyncInterval) {\n              clearInterval(this.playerSyncInterval);\n              this.playerSyncInterval = undefined;\n            }\n\n            return [3, 5];\n\n          case 4:\n            error_10 = _a.sent();\n            console.error(error_10);\n            return [3, 5];\n\n          case 5:\n            return [2];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.handlePlaybackStatus = function () {\n    var isPlaying = this.state.isPlaying;\n\n    if (isPlaying) {\n      if (!this.playerProgressInterval) {\n        this.playerProgressInterval = window.setInterval(this.updateSeekBar, this.seekUpdateInterval);\n      }\n    } else {\n      if (this.playerProgressInterval) {\n        clearInterval(this.playerProgressInterval);\n        this.playerProgressInterval = undefined;\n      }\n    }\n  };\n\n  SpotifyWebPlayer.prototype.initializeDevices = function (deviceId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, persistDeviceSelection, token, devices, currentDeviceId, savedDeviceId_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this.props, persistDeviceSelection = _a.persistDeviceSelection, token = _a.token;\n            return [4, spotify_1.getDevices(token)];\n\n          case 1:\n            devices = _b.sent().devices;\n            currentDeviceId = deviceId;\n\n            if (persistDeviceSelection) {\n              savedDeviceId_1 = sessionStorage.getItem('rswpDeviceId');\n\n              if (!savedDeviceId_1 || !devices.find(function (d) {\n                return d.id === savedDeviceId_1;\n              })) {\n                sessionStorage.setItem('rswpDeviceId', currentDeviceId);\n              } else {\n                currentDeviceId = savedDeviceId_1;\n              }\n            }\n\n            return [2, {\n              currentDeviceId: currentDeviceId,\n              devices: devices\n            }];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.setAlbumImage = function (album) {\n    var width = Math.min.apply(Math, __spread(album.images.map(function (d) {\n      return d.width;\n    })));\n    var thumb = album.images.find(function (d) {\n      return d.width === width;\n    }) || {};\n    return thumb.url;\n  };\n\n  SpotifyWebPlayer.prototype.render = function () {\n    var _a = this.state,\n        currentDeviceId = _a.currentDeviceId,\n        deviceId = _a.deviceId,\n        devices = _a.devices,\n        error = _a.error,\n        errorType = _a.errorType,\n        isActive = _a.isActive,\n        isMagnified = _a.isMagnified,\n        isUnsupported = _a.isUnsupported,\n        isPlaying = _a.isPlaying,\n        nextTracks = _a.nextTracks,\n        position = _a.position,\n        previousTracks = _a.previousTracks,\n        status = _a.status,\n        track = _a.track,\n        volume = _a.volume;\n    var _b = this.props,\n        name = _b.name,\n        showSaveIcon = _b.showSaveIcon,\n        token = _b.token,\n        updateSavedStatus = _b.updateSavedStatus;\n    var isReady = [utils_1.STATUS.READY, utils_1.STATUS.UNSUPPORTED].indexOf(status) >= 0;\n    var isPlaybackError = errorType === 'playback_error';\n    var output = React.createElement(Loader_1.default, {\n      styles: this.styles\n    });\n    var info;\n\n    if (isPlaybackError) {\n      info = React.createElement(\"p\", null, error);\n    }\n\n    if (isReady) {\n      if (!info) {\n        info = React.createElement(Info_1.default, {\n          handleFavoriteStatusChange: this.handleFavoriteStatusChange,\n          showSaveIcon: showSaveIcon,\n          isActive: isActive,\n          styles: this.styles,\n          token: token,\n          track: track,\n          updateSavedStatus: updateSavedStatus\n        });\n      }\n\n      output = React.createElement(React.Fragment, null, React.createElement(\"div\", null, info), React.createElement(Controls_1.default, {\n        isExternalDevice: this.isExternalPlayer,\n        isPlaying: isPlaying,\n        onClickNext: this.handleClickNext,\n        onClickPrevious: this.handleClickPrevious,\n        onClickTogglePlay: this.handleClickTogglePlay,\n        nextTracks: nextTracks,\n        previousTracks: previousTracks,\n        styles: this.styles\n      }), React.createElement(Actions_1.default, {\n        currentDeviceId: currentDeviceId,\n        devices: devices,\n        isDevicesOpen: isUnsupported && !deviceId,\n        onClickDevice: this.handleClickDevice,\n        setVolume: this.setVolume,\n        styles: this.styles,\n        volume: volume\n      }));\n    }\n\n    if (status === utils_1.STATUS.ERROR) {\n      output = React.createElement(ErrorMessage_1.default, {\n        styles: this.styles\n      }, name, \": \", error);\n    }\n\n    return React.createElement(Player_1.default, {\n      styles: this.styles\n    }, isReady && React.createElement(Slider_1.default, {\n      isMagnified: isMagnified,\n      onChangeRange: this.handleChangeRange,\n      onToggleMagnify: this.handleToggleMagnify,\n      position: position,\n      styles: this.styles\n    }), React.createElement(Content_1.default, {\n      styles: this.styles\n    }, output));\n  };\n\n  SpotifyWebPlayer.defaultProps = {\n    callback: function () {\n      return undefined;\n    },\n    magnifySliderOnHover: false,\n    name: 'Spotify Web Player',\n    showSaveIcon: false,\n    syncExternalDeviceInterval: 5\n  };\n  return SpotifyWebPlayer;\n}(React.PureComponent);\n\nexports.default = SpotifyWebPlayer;","map":{"version":3,"sources":["/Users/dbanta/Desktop/Aux React/aux-pwa/node_modules/react-spotify-web-playback/lib/index.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","__spread","concat","defineProperty","exports","React","require","spotify_1","styles_1","utils_1","STATUS","TYPE","Actions_1","Content_1","Controls_1","ErrorMessage_1","Info_1","Loader_1","Player_1","Slider_1","SpotifyWebPlayer","_super","props","_this","_isMounted","emptyTrack","artists","durationMs","id","image","name","uri","hasNewToken","seekUpdateInterval","handleChangeRange","position","track","token","percentage","state","error_1","_a","isExternalPlayer","seek","Math","round","updateState","progressMs","player","getCurrentState","track_window","current_track","duration_ms","console","handleClickTogglePlay","error_2","togglePlay","handleClickPrevious","error_3","previous","syncTimeout","window","setTimeout","syncDevice","previousTrack","handleClickNext","error_4","nextTrack","handleClickDevice","deviceId","isUnsupported","error_5","currentDeviceId","setDevice","handleFavoriteStatusChange","isSaved","callback","type","TRACK","handlePlayerErrors","message","status","isPlaybackError","isInitializationError","nextStatus","disconnect","UNSUPPORTED","ERROR","errorType","isInitializing","handlePlayerStateChanges","isPlaying","album","name_1","volume","error_6","_b","log","paused","getVolume","map","join","setAlbumImage","isActive","nextTracks","next_tracks","previousTracks","previous_tracks","handlePlayerStatus","device_id","devices","_c","initializeDevices","READY","IDLE","handleToggleMagnify","magnifySliderOnHover","prevState","isMagnified","initializePlayer","Spotify","Player","getOAuthToken","cb","addListener","connect","setVolume","error_7","getPlaybackState","Error","item","is_playing","progress_ms","device","volume_percent","toggleOffset","offset","uris","isArray","play","init","needsUpdate","shouldInitialize","playerState","error_8","playOptions","undefined","pause","context_uri","updateSeekBar","error_9","Number","isFinite","toFixed","setState","styles","getMergedStyles","componentDidMount","INITIALIZING","onSpotifyWebPlaybackSDKReady","loadScript","defer","source","componentDidUpdate","prevProps","autoPlay","playProp","showSaveIcon","isReady","changedURIs","canPlay","shouldPlay","isEqualArray","handleDeviceChange","DEVICE","handlePlaybackStatus","PLAYER","componentWillUnmount","clearInterval","playerSyncInterval","playerProgressInterval","clearTimeout","get","enumerable","configurable","response","ids","getSpotifyURIType","filter","validateURI","syncExternalDeviceInterval","error_10","setInterval","persistDeviceSelection","savedDeviceId_1","getDevices","sessionStorage","getItem","find","setItem","width","min","images","thumb","url","render","updateSavedStatus","indexOf","output","createElement","default","info","Fragment","isExternalDevice","onClickNext","onClickPrevious","onClickTogglePlay","isDevicesOpen","onClickDevice","onChangeRange","onToggleMagnify","defaultProps","PureComponent"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar spotify_1 = require(\"./spotify\");\nvar styles_1 = require(\"./styles\");\nvar utils_1 = require(\"./utils\");\nexports.STATUS = utils_1.STATUS;\nexports.TYPE = utils_1.TYPE;\nvar Actions_1 = require(\"./components/Actions\");\nvar Content_1 = require(\"./components/Content\");\nvar Controls_1 = require(\"./components/Controls\");\nvar ErrorMessage_1 = require(\"./components/ErrorMessage\");\nvar Info_1 = require(\"./components/Info\");\nvar Loader_1 = require(\"./components/Loader\");\nvar Player_1 = require(\"./components/Player\");\nvar Slider_1 = require(\"./components/Slider\");\nvar SpotifyWebPlayer = (function (_super) {\n    __extends(SpotifyWebPlayer, _super);\n    function SpotifyWebPlayer(props) {\n        var _this = _super.call(this, props) || this;\n        _this._isMounted = false;\n        _this.emptyTrack = {\n            artists: '',\n            durationMs: 0,\n            id: '',\n            image: '',\n            name: '',\n            uri: '',\n        };\n        _this.hasNewToken = false;\n        _this.seekUpdateInterval = 100;\n        _this.handleChangeRange = function (position) { return __awaiter(_this, void 0, void 0, function () {\n            var track, token, percentage, state, error_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        track = this.state.track;\n                        token = this.props.token;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 8, , 9]);\n                        percentage = position / 100;\n                        if (!this.isExternalPlayer) return [3, 3];\n                        return [4, spotify_1.seek(Math.round(track.durationMs * percentage), token)];\n                    case 2:\n                        _a.sent();\n                        this.updateState({\n                            position: position,\n                            progressMs: Math.round(track.durationMs * percentage),\n                        });\n                        return [3, 7];\n                    case 3:\n                        if (!this.player) return [3, 7];\n                        return [4, this.player.getCurrentState()];\n                    case 4:\n                        state = (_a.sent());\n                        if (!state) return [3, 6];\n                        return [4, this.player.seek(Math.round(state.track_window.current_track.duration_ms * percentage))];\n                    case 5:\n                        _a.sent();\n                        return [3, 7];\n                    case 6:\n                        this.updateState({ position: 0 });\n                        _a.label = 7;\n                    case 7: return [3, 9];\n                    case 8:\n                        error_1 = _a.sent();\n                        console.error(error_1);\n                        return [3, 9];\n                    case 9: return [2];\n                }\n            });\n        }); };\n        _this.handleClickTogglePlay = function () { return __awaiter(_this, void 0, void 0, function () {\n            var error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4, this.togglePlay()];\n                    case 1:\n                        _a.sent();\n                        return [3, 3];\n                    case 2:\n                        error_2 = _a.sent();\n                        console.error(error_2);\n                        return [3, 3];\n                    case 3: return [2];\n                }\n            });\n        }); };\n        _this.handleClickPrevious = function () { return __awaiter(_this, void 0, void 0, function () {\n            var token, error_3;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 5, , 6]);\n                        if (!this.isExternalPlayer) return [3, 2];\n                        token = this.props.token;\n                        return [4, spotify_1.previous(token)];\n                    case 1:\n                        _a.sent();\n                        this.syncTimeout = window.setTimeout(function () {\n                            _this.syncDevice();\n                        }, 300);\n                        return [3, 4];\n                    case 2:\n                        if (!this.player) return [3, 4];\n                        return [4, this.player.previousTrack()];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [3, 6];\n                    case 5:\n                        error_3 = _a.sent();\n                        console.error(error_3);\n                        return [3, 6];\n                    case 6: return [2];\n                }\n            });\n        }); };\n        _this.handleClickNext = function () { return __awaiter(_this, void 0, void 0, function () {\n            var token, error_4;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 5, , 6]);\n                        if (!this.isExternalPlayer) return [3, 2];\n                        token = this.props.token;\n                        return [4, spotify_1.next(token)];\n                    case 1:\n                        _a.sent();\n                        this.syncTimeout = window.setTimeout(function () {\n                            _this.syncDevice();\n                        }, 300);\n                        return [3, 4];\n                    case 2:\n                        if (!this.player) return [3, 4];\n                        return [4, this.player.nextTrack()];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [3, 6];\n                    case 5:\n                        error_4 = _a.sent();\n                        console.error(error_4);\n                        return [3, 6];\n                    case 6: return [2];\n                }\n            });\n        }); };\n        _this.handleClickDevice = function (deviceId) { return __awaiter(_this, void 0, void 0, function () {\n            var isUnsupported, token, error_5;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isUnsupported = this.state.isUnsupported;\n                        token = this.props.token;\n                        this.updateState({ currentDeviceId: deviceId });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 6, , 7]);\n                        return [4, spotify_1.setDevice(deviceId, token)];\n                    case 2:\n                        _a.sent();\n                        if (!isUnsupported) return [3, 5];\n                        return [4, this.togglePlay(true)];\n                    case 3:\n                        _a.sent();\n                        return [4, this.syncDevice()];\n                    case 4:\n                        _a.sent();\n                        _a.label = 5;\n                    case 5: return [3, 7];\n                    case 6:\n                        error_5 = _a.sent();\n                        console.error(error_5);\n                        return [3, 7];\n                    case 7: return [2];\n                }\n            });\n        }); };\n        _this.handleFavoriteStatusChange = function (isSaved) {\n            var callback = _this.props.callback;\n            _this.updateState({ isSaved: isSaved });\n            callback(__assign({}, __assign({}, _this.state, { isSaved: isSaved }), { type: utils_1.TYPE.TRACK }));\n        };\n        _this.handlePlayerErrors = function (type, message) { return __awaiter(_this, void 0, void 0, function () {\n            var status, isPlaybackError, isInitializationError, nextStatus;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        status = this.state.status;\n                        isPlaybackError = type === 'playback_error';\n                        isInitializationError = type === 'initialization_error';\n                        nextStatus = status;\n                        if (!(this.player && !isPlaybackError)) return [3, 2];\n                        return [4, this.player.disconnect()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        if (isInitializationError) {\n                            nextStatus = utils_1.STATUS.UNSUPPORTED;\n                        }\n                        if (!isInitializationError && !isPlaybackError) {\n                            nextStatus = utils_1.STATUS.ERROR;\n                        }\n                        this.updateState({\n                            error: message,\n                            errorType: type,\n                            isInitializing: false,\n                            isUnsupported: isInitializationError,\n                            status: nextStatus,\n                        });\n                        return [2];\n                }\n            });\n        }); };\n        _this.handlePlayerStateChanges = function (state) { return __awaiter(_this, void 0, void 0, function () {\n            var isPlaying, _a, album, artists, duration_ms, id, name_1, uri, volume, track, error_6;\n            return __generator(this, function (_b) {\n                console.log('PlayerStateChange', _b.label);\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 6, , 7]);\n                        if (!state) return [3, 2];\n                        isPlaying = !state.paused;\n                        _a = state.track_window.current_track, album = _a.album, artists = _a.artists, duration_ms = _a.duration_ms, id = _a.id, name_1 = _a.name, uri = _a.uri;\n                        return [4, this.player.getVolume()];\n                    case 1:\n                        volume = _b.sent();\n                        track = {\n                            artists: artists.map(function (d) { return d.name; }).join(', '),\n                            durationMs: duration_ms,\n                            id: id,\n                            image: this.setAlbumImage(album),\n                            name: name_1,\n                            uri: uri,\n                        };\n                        this.updateState({\n                            error: '',\n                            errorType: '',\n                            isActive: true,\n                            isPlaying: isPlaying,\n                            nextTracks: state.track_window.next_tracks,\n                            previousTracks: state.track_window.previous_tracks,\n                            track: track,\n                            volume: volume,\n                        });\n                        return [3, 5];\n                    case 2:\n                        if (!this.isExternalPlayer) return [3, 4];\n                        return [4, this.syncDevice()];\n                    case 3:\n                        _b.sent();\n                        return [3, 5];\n                    case 4:\n                        this.updateState({\n                            isActive: false,\n                            isPlaying: false,\n                            nextTracks: [],\n                            position: 0,\n                            previousTracks: [],\n                            track: {\n                                artists: '',\n                                durationMs: 0,\n                                id: '',\n                                image: '',\n                                name: '',\n                                uri: '',\n                            },\n                        });\n                        _b.label = 5;\n                    case 5: return [3, 7];\n                    case 6:\n                        error_6 = _b.sent();\n                        console.error(error_6);\n                        return [3, 7];\n                    case 7: return [2];\n                }\n            });\n        }); };\n        _this.handlePlayerStatus = function (_a) {\n            var device_id = _a.device_id;\n            return __awaiter(_this, void 0, void 0, function () {\n                var _b, currentDeviceId, devices;\n                return __generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0: return [4, this.initializeDevices(device_id)];\n                        case 1:\n                            _b = _c.sent(), currentDeviceId = _b.currentDeviceId, devices = _b.devices;\n                            this.updateState({\n                                currentDeviceId: currentDeviceId,\n                                deviceId: device_id,\n                                devices: devices,\n                                isInitializing: false,\n                                status: device_id ? utils_1.STATUS.READY : utils_1.STATUS.IDLE,\n                            });\n                            return [2];\n                    }\n                });\n            });\n        };\n        _this.handleToggleMagnify = function () {\n            var magnifySliderOnHover = _this.props.magnifySliderOnHover;\n            if (magnifySliderOnHover) {\n                _this.updateState(function (prevState) {\n                    return { isMagnified: !prevState.isMagnified };\n                });\n            }\n        };\n        _this.initializePlayer = function () {\n            var _a = _this.props, name = _a.name, token = _a.token;\n            _this.updateState({ isInitializing: true });\n            _this.player = new window.Spotify.Player({\n                getOAuthToken: function (cb) {\n                    cb(token);\n                },\n                name: name,\n            });\n            _this.player.addListener('ready', _this.handlePlayerStatus);\n            _this.player.addListener('not_ready', _this.handlePlayerStatus);\n            _this.player.addListener('player_state_changed', _this.handlePlayerStateChanges);\n            _this.player.addListener('initialization_error', function (error) {\n                return _this.handlePlayerErrors('initialization_error', error.message);\n            });\n            _this.player.addListener('authentication_error', function (error) {\n                return _this.handlePlayerErrors('authentication_error', error.message);\n            });\n            _this.player.addListener('account_error', function (error) {\n                return _this.handlePlayerErrors('account_error', error.message);\n            });\n            _this.player.addListener('playback_error', function (error) {\n                return _this.handlePlayerErrors('playback_error', error.message);\n            });\n            _this.player.connect();\n\n        };\n        _this.setVolume = function (volume) { return __awaiter(_this, void 0, void 0, function () {\n            var token;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        token = this.props.token;\n                        if (!this.isExternalPlayer) return [3, 3];\n                        return [4, spotify_1.setVolume(Math.round(volume * 100), token)];\n                    case 1:\n                        _a.sent();\n                        return [4, this.syncDevice()];\n                    case 2:\n                        _a.sent();\n                        return [3, 5];\n                    case 3:\n                        if (!this.player) return [3, 5];\n                        return [4, this.player.setVolume(volume)];\n                    case 4:\n                        _a.sent();\n                        _a.label = 5;\n                    case 5:\n                        this.updateState({ volume: volume });\n                        return [2];\n                }\n            });\n        }); };\n        _this.syncDevice = function () { return __awaiter(_this, void 0, void 0, function () {\n            var token, player, track, error_7;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this._isMounted) {\n                            return [2];\n                        }\n                        token = this.props.token;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4, spotify_1.getPlaybackState(token)];\n                    case 2:\n                        player = _a.sent();\n                        track = this.emptyTrack;\n                        if (!player) {\n                            throw new Error('No player');\n                        }\n                        if (player.item) {\n                            track = {\n                                artists: player.item.artists.map(function (d) { return d.name; }).join(', '),\n                                durationMs: player.item.duration_ms,\n                                id: player.item.id,\n                                image: this.setAlbumImage(player.item.album),\n                                name: player.item.name,\n                                uri: player.item.uri,\n                            };\n                        }\n                        this.updateState({\n                            error: '',\n                            errorType: '',\n                            isActive: true,\n                            isPlaying: player.is_playing,\n                            nextTracks: [],\n                            previousTracks: [],\n                            progressMs: player.item ? player.progress_ms : 0,\n                            status: utils_1.STATUS.READY,\n                            track: track,\n                            volume: player.device.volume_percent / 100,\n                        });\n                        return [3, 4];\n                    case 3:\n                        error_7 = _a.sent();\n                        this.updateState({\n                            error: error_7.message,\n                            errorType: 'player_status',\n                            status: utils_1.STATUS.ERROR,\n                        });\n                        return [3, 4];\n                    case 4: return [2];\n                }\n            });\n        }); };\n        _this.toggleOffset = function () { return __awaiter(_this, void 0, void 0, function () {\n            var _a, currentDeviceId, isPlaying, _b, offset, token, uris;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying;\n                        _b = this.props, offset = _b.offset, token = _b.token, uris = _b.uris;\n                        if (!(isPlaying && typeof offset === 'number' && Array.isArray(uris))) return [3, 2];\n                        return [4, spotify_1.play({ deviceId: currentDeviceId, offset: offset, uris: uris }, token)];\n                    case 1:\n                        _c.sent();\n                        _c.label = 2;\n                    case 2: return [2];\n                }\n            });\n        }); };\n        _this.togglePlay = function (init) {\n            if (init === void 0) { init = false; }\n            return __awaiter(_this, void 0, void 0, function () {\n                var _a, currentDeviceId, isPlaying, needsUpdate, _b, offset, token, shouldInitialize, playerState, error_8;\n                var _this = this;\n                return __generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0:\n                            _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying, needsUpdate = _a.needsUpdate;\n                            _b = this.props, offset = _b.offset, token = _b.token;\n                            shouldInitialize = init || needsUpdate;\n                            _c.label = 1;\n                        case 1:\n                            _c.trys.push([1, 12, , 13]);\n                            if (!this.isExternalPlayer) return [3, 6];\n                            if (!!isPlaying) return [3, 3];\n                            return [4, spotify_1.play(__assign({ deviceId: currentDeviceId, offset: offset }, (shouldInitialize ? this.playOptions : undefined)), token)];\n                        case 2:\n                            _c.sent();\n                            return [3, 5];\n                        case 3: return [4, spotify_1.pause(token)];\n                        case 4:\n                            _c.sent();\n                            this.updateState({ isPlaying: false });\n                            _c.label = 5;\n                        case 5:\n                            this.syncTimeout = window.setTimeout(function () {\n                                _this.syncDevice();\n                            }, 300);\n                            return [3, 11];\n                        case 6:\n                            if (!this.player) return [3, 11];\n                            return [4, this.player.getCurrentState()];\n                        case 7:\n                            playerState = _c.sent();\n                            if (!((!playerState && !!(this.playOptions.context_uri || this.playOptions.uris)) ||\n                                (shouldInitialize && playerState && playerState.paused))) return [3, 9];\n                            return [4, spotify_1.play(__assign({ deviceId: currentDeviceId, offset: offset }, (shouldInitialize ? this.playOptions : undefined)), token)];\n                        case 8:\n                            _c.sent();\n                            return [3, 11];\n                        case 9: return [4, this.player.togglePlay()];\n                        case 10:\n                            _c.sent();\n                            _c.label = 11;\n                        case 11:\n                            if (needsUpdate) {\n                                this.updateState({ needsUpdate: false });\n                            }\n                            return [3, 13];\n                        case 12:\n                            error_8 = _c.sent();\n                            console.error(error_8);\n                            return [3, 13];\n                        case 13: return [2];\n                    }\n                });\n            });\n        };\n        _this.updateSeekBar = function () { return __awaiter(_this, void 0, void 0, function () {\n            var _a, isPlaying, progressMs, track, position, state, position, error_9;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this._isMounted) {\n                            return [2];\n                        }\n                        _a = this.state, isPlaying = _a.isPlaying, progressMs = _a.progressMs, track = _a.track;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 5, , 6]);\n                        if (!isPlaying) return [3, 4];\n                        if (!this.isExternalPlayer) return [3, 2];\n                        position = progressMs / track.durationMs;\n                        position = Number.isFinite(position) ? position : 0;\n                        this.updateState({\n                            position: Number((position * 100).toFixed(1)),\n                            progressMs: progressMs + this.seekUpdateInterval,\n                        });\n                        return [3, 4];\n                    case 2:\n                        if (!this.player) return [3, 4];\n                        return [4, this.player.getCurrentState()];\n                    case 3:\n                        state = (_b.sent());\n                        if (state) {\n                            position = state.position / state.track_window.current_track.duration_ms;\n                            this.updateState({ position: Number((position * 100).toFixed(1)) });\n                        }\n                        _b.label = 4;\n                    case 4: return [3, 6];\n                    case 5:\n                        error_9 = _b.sent();\n                        console.error(error_9);\n                        return [3, 6];\n                    case 6: return [2];\n                }\n            });\n        }); };\n        _this.updateState = function (state) {\n            if (!_this._isMounted) {\n                return;\n            }\n            _this.setState(state);\n        };\n        _this.state = {\n            currentDeviceId: '',\n            deviceId: '',\n            devices: [],\n            error: '',\n            errorType: '',\n            isActive: false,\n            isInitializing: false,\n            isMagnified: false,\n            isPlaying: false,\n            isSaved: false,\n            isUnsupported: false,\n            needsUpdate: false,\n            nextTracks: [],\n            position: 0,\n            previousTracks: [],\n            status: utils_1.STATUS.IDLE,\n            track: _this.emptyTrack,\n            volume: 1,\n        };\n        _this.styles = styles_1.getMergedStyles(props.styles);\n        return _this;\n    }\n    SpotifyWebPlayer.prototype.componentDidMount = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this._isMounted = true;\n                        this.updateState({ status: utils_1.STATUS.INITIALIZING });\n                        window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n                        return [4, utils_1.loadScript({\n                                defer: true,\n                                id: 'spotify-player',\n                                source: 'https://sdk.scdn.co/spotify-player.js',\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2];\n                }\n            });\n        });\n    };\n    SpotifyWebPlayer.prototype.componentDidUpdate = function (prevProps, prevState) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, currentDeviceId, deviceId, error, isInitializing, isPlaying, status, track, _b, autoPlay, callback, offset, playProp, showSaveIcon, token, uris, isReady, changedURIs, canPlay, shouldPlay;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.state, currentDeviceId = _a.currentDeviceId, deviceId = _a.deviceId, error = _a.error, isInitializing = _a.isInitializing, isPlaying = _a.isPlaying, status = _a.status, track = _a.track;\n                        _b = this.props, autoPlay = _b.autoPlay, callback = _b.callback, offset = _b.offset, playProp = _b.play, showSaveIcon = _b.showSaveIcon, token = _b.token, uris = _b.uris;\n                        isReady = prevState.status !== utils_1.STATUS.READY && status === utils_1.STATUS.READY;\n                        changedURIs = Array.isArray(uris) ? !utils_1.isEqualArray(prevProps.uris, uris) : uris !== uris;\n                        canPlay = !!currentDeviceId && !!(this.playOptions.context_uri || this.playOptions.uris);\n                        shouldPlay = !!(changedURIs && isPlaying) || !!(isReady && (autoPlay || playProp));\n                        if (!(canPlay && shouldPlay)) return [3, 2];\n                        return [4, spotify_1.play(__assign({ deviceId: currentDeviceId, offset: offset }, this.playOptions), token)];\n                    case 1:\n                        _c.sent();\n                        if (!this.state.isPlaying) {\n                            this.updateState({ isPlaying: true });\n                        }\n                        if (this.isExternalPlayer) {\n                            this.syncTimeout = window.setTimeout(function () {\n                                _this.syncDevice();\n                            }, 600);\n                        }\n                        return [3, 3];\n                    case 2:\n                        if (changedURIs && !isPlaying) {\n                            this.updateState({ needsUpdate: true });\n                        }\n                        _c.label = 3;\n                    case 3:\n                        if (prevState.status !== status) {\n                            callback(__assign({}, this.state, { type: utils_1.TYPE.STATUS }));\n                        }\n                        if (prevState.track.id !== track.id && track.id) {\n                            callback(__assign({}, this.state, { type: utils_1.TYPE.TRACK }));\n                            if (showSaveIcon) {\n                                this.updateState({ isSaved: false });\n                            }\n                        }\n                        if (!(prevState.currentDeviceId !== currentDeviceId && currentDeviceId)) return [3, 5];\n                        return [4, this.handleDeviceChange()];\n                    case 4:\n                        _c.sent();\n                        if (!isReady) {\n                            callback(__assign({}, this.state, { type: utils_1.TYPE.DEVICE }));\n                        }\n                        _c.label = 5;\n                    case 5:\n                        if (!(prevState.isPlaying !== isPlaying)) return [3, 7];\n                        this.handlePlaybackStatus();\n                        return [4, this.handleDeviceChange()];\n                    case 6:\n                        _c.sent();\n                        callback(__assign({}, this.state, { type: utils_1.TYPE.PLAYER }));\n                        _c.label = 7;\n                    case 7:\n                        if (prevState.isInitializing && !isInitializing) {\n                            if (error === 'authentication_error' && this.hasNewToken) {\n                                this.hasNewToken = false;\n                                this.initializePlayer();\n                            }\n                        }\n                        if (prevProps.token && prevProps.token !== token) {\n                            this.hasNewToken = true;\n                            if (!isInitializing) {\n                                this.initializePlayer();\n                            }\n                            else {\n                                this.hasNewToken = true;\n                            }\n                        }\n                        if (!(prevProps.play !== playProp && playProp !== isPlaying)) return [3, 9];\n                        return [4, this.togglePlay(true)];\n                    case 8:\n                        _c.sent();\n                        _c.label = 9;\n                    case 9:\n                        if (!(prevProps.offset !== offset)) return [3, 11];\n                        return [4, this.toggleOffset()];\n                    case 10:\n                        _c.sent();\n                        _c.label = 11;\n                    case 11:\n                        if (error === 'No player') {\n                            this.updateState({\n                                currentDeviceId: deviceId,\n                                error: '',\n                                errorType: '',\n                            });\n                        }\n                        return [2];\n                }\n            });\n        });\n    };\n    SpotifyWebPlayer.prototype.componentWillUnmount = function () {\n        this._isMounted = false;\n        if (this.player) {\n            this.player.disconnect();\n        }\n        clearInterval(this.playerSyncInterval);\n        clearInterval(this.playerProgressInterval);\n        clearTimeout(this.syncTimeout);\n    };\n    Object.defineProperty(SpotifyWebPlayer.prototype, \"isExternalPlayer\", {\n        get: function () {\n            var _a = this.state, currentDeviceId = _a.currentDeviceId, deviceId = _a.deviceId, status = _a.status;\n            return (currentDeviceId && currentDeviceId !== deviceId) || status === utils_1.STATUS.UNSUPPORTED;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(SpotifyWebPlayer.prototype, \"playOptions\", {\n        get: function () {\n            var uris = this.props.uris;\n            var response = {\n                context_uri: undefined,\n                uris: undefined,\n            };\n            if (uris) {\n                var ids = Array.isArray(uris) ? uris : [uris];\n                if (ids.length > 1 && utils_1.getSpotifyURIType(ids[0]) === 'track') {\n                    response.uris = ids.filter(function (d) { return utils_1.validateURI(d) && utils_1.getSpotifyURIType(d) === 'track'; });\n                }\n                else {\n                    response.context_uri = ids[0];\n                }\n            }\n            return response;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SpotifyWebPlayer.prototype.handleDeviceChange = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var isPlaying, syncExternalDeviceInterval, error_10;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isPlaying = this.state.isPlaying;\n                        syncExternalDeviceInterval = this.props.syncExternalDeviceInterval;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 4, , 5]);\n                        if (!(this.isExternalPlayer && isPlaying && !this.playerSyncInterval)) return [3, 3];\n                        return [4, this.syncDevice()];\n                    case 2:\n                        _a.sent();\n                        this.playerSyncInterval = window.setInterval(this.syncDevice, syncExternalDeviceInterval * 1000);\n                        _a.label = 3;\n                    case 3:\n                        if ((!isPlaying || !this.isExternalPlayer) && this.playerSyncInterval) {\n                            clearInterval(this.playerSyncInterval);\n                            this.playerSyncInterval = undefined;\n                        }\n                        return [3, 5];\n                    case 4:\n                        error_10 = _a.sent();\n                        console.error(error_10);\n                        return [3, 5];\n                    case 5: return [2];\n                }\n            });\n        });\n    };\n    SpotifyWebPlayer.prototype.handlePlaybackStatus = function () {\n        var isPlaying = this.state.isPlaying;\n        if (isPlaying) {\n            if (!this.playerProgressInterval) {\n                this.playerProgressInterval = window.setInterval(this.updateSeekBar, this.seekUpdateInterval);\n            }\n        }\n        else {\n            if (this.playerProgressInterval) {\n                clearInterval(this.playerProgressInterval);\n                this.playerProgressInterval = undefined;\n            }\n        }\n    };\n    SpotifyWebPlayer.prototype.initializeDevices = function (deviceId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, persistDeviceSelection, token, devices, currentDeviceId, savedDeviceId_1;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.props, persistDeviceSelection = _a.persistDeviceSelection, token = _a.token;\n                        return [4, spotify_1.getDevices(token)];\n                    case 1:\n                        devices = (_b.sent()).devices;\n                        currentDeviceId = deviceId;\n                        if (persistDeviceSelection) {\n                            savedDeviceId_1 = sessionStorage.getItem('rswpDeviceId');\n                            if (!savedDeviceId_1 || !devices.find(function (d) { return d.id === savedDeviceId_1; })) {\n                                sessionStorage.setItem('rswpDeviceId', currentDeviceId);\n                            }\n                            else {\n                                currentDeviceId = savedDeviceId_1;\n                            }\n                        }\n                        return [2, { currentDeviceId: currentDeviceId, devices: devices }];\n                }\n            });\n        });\n    };\n    SpotifyWebPlayer.prototype.setAlbumImage = function (album) {\n        var width = Math.min.apply(Math, __spread(album.images.map(function (d) { return d.width; })));\n        var thumb = album.images.find(function (d) { return d.width === width; }) || {};\n        return thumb.url;\n    };\n    SpotifyWebPlayer.prototype.render = function () {\n        var _a = this.state, currentDeviceId = _a.currentDeviceId, deviceId = _a.deviceId, devices = _a.devices, error = _a.error, errorType = _a.errorType, isActive = _a.isActive, isMagnified = _a.isMagnified, isUnsupported = _a.isUnsupported, isPlaying = _a.isPlaying, nextTracks = _a.nextTracks, position = _a.position, previousTracks = _a.previousTracks, status = _a.status, track = _a.track, volume = _a.volume;\n        var _b = this.props, name = _b.name, showSaveIcon = _b.showSaveIcon, token = _b.token, updateSavedStatus = _b.updateSavedStatus;\n        var isReady = [utils_1.STATUS.READY, utils_1.STATUS.UNSUPPORTED].indexOf(status) >= 0;\n        var isPlaybackError = errorType === 'playback_error';\n        var output = React.createElement(Loader_1.default, { styles: this.styles });\n        var info;\n        if (isPlaybackError) {\n            info = React.createElement(\"p\", null, error);\n        }\n        if (isReady) {\n            if (!info) {\n                info = (React.createElement(Info_1.default, { handleFavoriteStatusChange: this.handleFavoriteStatusChange, showSaveIcon: showSaveIcon, isActive: isActive, styles: this.styles, token: token, track: track, updateSavedStatus: updateSavedStatus }));\n            }\n            output = (React.createElement(React.Fragment, null,\n                React.createElement(\"div\", null, info),\n                React.createElement(Controls_1.default, { isExternalDevice: this.isExternalPlayer, isPlaying: isPlaying, onClickNext: this.handleClickNext, onClickPrevious: this.handleClickPrevious, onClickTogglePlay: this.handleClickTogglePlay, nextTracks: nextTracks, previousTracks: previousTracks, styles: this.styles }),\n                React.createElement(Actions_1.default, { currentDeviceId: currentDeviceId, devices: devices, isDevicesOpen: isUnsupported && !deviceId, onClickDevice: this.handleClickDevice, setVolume: this.setVolume, styles: this.styles, volume: volume })));\n        }\n        if (status === utils_1.STATUS.ERROR) {\n            output = (React.createElement(ErrorMessage_1.default, { styles: this.styles },\n                name,\n                \": \",\n                error));\n        }\n        return (React.createElement(Player_1.default, { styles: this.styles },\n            isReady && (React.createElement(Slider_1.default, { isMagnified: isMagnified, onChangeRange: this.handleChangeRange, onToggleMagnify: this.handleToggleMagnify, position: position, styles: this.styles })),\n            React.createElement(Content_1.default, { styles: this.styles }, output)));\n    };\n    SpotifyWebPlayer.defaultProps = {\n        callback: function () { return undefined; },\n        magnifySliderOnHover: false,\n        name: 'Spotify Web Player',\n        showSaveIcon: false,\n        syncExternalDeviceInterval: 5,\n    };\n    return SpotifyWebPlayer;\n}(React.PureComponent));\nexports.default = SpotifyWebPlayer;\n"]},"metadata":{},"sourceType":"script"}